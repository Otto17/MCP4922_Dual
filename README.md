# Библиотека для удобного использования ЦАП MCP4922.

Управление производится каждым каналом по отдельности.
Изменение значений на одном канале, не влияют на выход второго канала.

##

Используется аппаратный SPI интерфейс.
Библиотека использует стандартные функции Arduino, поэтому будет работать с любой платой.

В библиотеке не использую пины отключения выходов "SHDN" - 9 pin ЦАП (он подтянут к Vcc)
и не использую одновременное обновление каналов "LDAC" - 8 pin ЦАП (он подтянут к GND).


Краткое описание регистров MCP4922:
```
Битовая маска для настройки параметров ЦАП'а MCP4922.

Четыре старших бита в маске 0b0111000000000000 (канал A) и 0b1111000000000000 (канал B)
предназначены для установка различных вариантов настройки ЦАП (страница в тех. документации №24).

0bX111000000000000 где X — канал ЦАП, в который пишет SPI.
bit15 A/B:
				   X=0 пишет на канал А.
				   X=1 пишет на канал B.

0b0X11000000000000 где X — режим с буферизацией или без буферизации.
Буферизация использует вывод LDAC для одновременного обновления обоих каналов (в этой библиотеке я не использую LDAC, поэтому этот вывод посадил на GND).
Небуферизованный режим записывает выходные данные непосредственно на выходы DAC и игнорирует вывод LDAC.
bit14 BUF:
				   X=0 не буферизовано.
				   X=1 буферизуется.

0b01x1000000000000 где X - селектор выходного усиления.  
bit13 GA:
				   X=0 это двухкратное усиление - 2x (VOUT = 2 * VREF * D/4096).
				   X=1 это однократное усиление - 1x (VOUT = VREF * D/4096).

0b011X000000000000 где X — управляющий бит отключения выходов MCP4922 (в этой библиотеке я не использую SHDN, поэтому этот вывод посадил на Vcc).
bit12 SHDN:
				   X=0 ВЫВОД MCP4922 отключён на выбранном канале.
				   X=1 ВЫВОД MCP4922 включён на выбранном канале.

0b0111XXXXXXXXXXXX где X - это 12 бит, которые должны быть записаны в активный канал. Бит с 11 до бита 0 (биты входных данных ЦАП. Бит X игнорируется).
```

### Использую настроки по умолчанию: бит слева направо: 1/2-й канал(A/B), с буферизацией, однократное усиление, выходы включены.


##

Подключение MCP4922 к Arduino (на примере Arduino UNO):

Vdd   ЦАП pin 1 на UNO pin 5V;

SHDN  ЦАП pin 9 на UNO pin 5V;

VrefB ЦАП pin 11 на UNO pin 5V;

VrefA ЦАП pin 13 на UNO pin 5V;


CS    ЦАП pin 3 на UNO pin 10;

SCK   ЦАП pin 4 на UNO pin 13;

SDI   ЦАП pin 5 на UNO pin 11;


LDAC  ЦАП pin 8 на UNO pin GND;

Vss   ЦАП pin 12 на UNO pin GND;


VoutA ЦАП pin 14 на UNO pin A1;

VoutB ЦАП pin 10 на UNO pin A2.



## Версии
- v1.0

##

Дата создания: 15.01.2024г.

Версия: 1.0

Автор: Otto.
